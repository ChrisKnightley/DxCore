# AVR64DD20/AVR32DD20/AVR16DD20

## Pin Mapping / Pinout
Pin mapping chart not yet available.

## Features and Peripherals
| Feature                          | AVR16DD20       | AVR32DD20       | AVR64DD20       |
|----------------------------------|-----------------|-----------------|-----------------|
| Flash Memory                     | 16384           | 32768           | 65536           |
| Flash Memory (with Optiboot)     | 15872           | 32256           | 65024           |
| SRAM                             | 2048            | 4096            | 8192            |
| EEPROM                           | 256             | 256             | 256             |
| User Row                         | 32              | 32              | 32              |
| Max. Frequency (rated, MHz)      | 24              | 24              | 24              |
| Clock Sources                    | INT, EXT, XTAL  | INT, EXT, XTAL  | INT, EXT, XTAL  |
| Packages Available               | SOIC-W, VQFN20  | SOIC-W, VQFN20  | SOIC-W, *VQFN20?* |
| Total pins on package            | 20              | 20              | 20              |
| I/O Pins (not reset/UPDI)        | 15              | 15              | 15              |
| Fully async pins                 | 17              | 17              | 17              |
| UPDI as I/O Pin                  | Yes             | Yes             | Yes             |
| PWM capable I/O pins             | 13              | 13              | 13              |
| Max simultaneous PWM outputs     | 8: 6+2          | 8: 6+2          | 8: 6+2          |
| 16-bit Type A Timers - pins ea   | 1: 6/3/2        | 1: 6/3/2        | 1: 6/3/2        |
| 16-bit Type B Timers, (pins)     | 2: 2            | 2: 2            | 2: 2            |
| 12-bit Type D pins               | 6               | 6               | 6               |
| USART (pin mappings)             | 2: 3/1          | 2: 3/1          | 2: 3/1          |
| SPI (pin mappings)               | 1: 3            | 1: 3            | 1: 3            |
| TWI/I2C (pin mappings)           | 1: 3            | 1: 3            | 1: 3            |
| 12-bit ADC input pins            | 10/13           | 10/13           | 10/13           |
| Of those, neg. diff. inputs      | all             | all             | all             |
| 10-bit DAC                       | 1               | 1               | 1               |
| Analog Comparator (AC)           | 1               | 1               | 1               |
| Zero-Cross Detectors (ZCD)       | 1               | 1               | 1               |
| Custom Logic Blocks (LUTs)       | 4               | 4               | 4               |
| Event System channels (out pins) | 6: 5            | 6: 5            | 6: 5            |
| On-chip opamps (OPAMP)           | -               | -               | -               |
| MVIO, pins                       | Yes, 3          | Yes, 3          | Yes, 3          |
| Flash Endurance                  | 1k              | 1k              | 1k              |
| LED_BUILTIN (and optiboot led)   | PIN_PA7         | PIN_PA7         | PIN_PA7         |

* If targeting the most PWM channels, the only option for the two TCBs overlaps with pins that TCA can use in it's most favorable spot.
* VQFN is the ultra-tiny 3mm x 3mm 0.4mm pitch one. 64k DD20s are not available in VQFN as of the time of writing.

## AVR DD - This is more akin to a souped up tinyAVR than an poverty model Dx
The 20 and 14 pin DD-series parts first releeased ase 32 and 16k parts, are much more exciting than their larger brothers, because they bring in Dx-class features at a price barely exceeding that of a similar tinyAVR. They're much cheaper than DB-series, barely above ATtiny parts, but come with most of the full suite of features. Obviously some things were cut versus the DB - memory being the most obvious,

### Fully async pins
All pins on the DDs are supposedly fully async, instead of just pins 2 and 6 within each port. Whether this is actually a good thing or not can be debated.

### USART0 mux options
| USART0  | swap |  TX |  RX | XDIR | XCK |
|---------|------|-----|-----|------|-----|
| DEFAULT | 0    | PA0 | PA1 |  PA2 | PA3 |
| ALT1    | 1    | PA4 | PA5 |  PA6 | PA7 |
| ALT2    | 2    | PA2 | PA3 |   -  |  -  |
| ALT3    | 3    | PD4 | PD5 |  PD6 | PD7 |
| ALT4    | 4    | PC1 | PC2 |  PC3 |  -  |

### USART1 mux options
| USART1  | swap |  TX |  RX | XDIR | XCK |
|---------|------|-----|-----|------|-----|
| DEFAULT | 0    |  -  | PC1 |  PC2 | PC3 |
| ALT2    | 2    | PD6 | PD7 |   -  |  -  |

DEFAULT is not terribly useful here. We don't have a graceful way to propagate the swap level when creating the USART objects though, and arguments against changing PORTMUX options willy-nilly have some weight. Just call swap(2).

### SPI0 mux options
| SPI0    | swap | MOSI | MISO | SCK |  SS |
|---------|------|------|------|-----|-----|
| DEFAULT | 0    |  PA4 |  PA5 | PA6 | PA7 |
| ~ALT3~  | ~3~  | ~PA0~ | ~PA1~ | ~-~ | ~PC1~ |
| ALT4    | 4    |  PD4 |  PD5 | PD6 | PD7 |
| ~ALT5~  | ~5~  |  ~-~ | ~PC1~ | ~PC2~ | ~PC3~ |
| ALT6    | 6    |  PC1 |  PC2 | PC3 | PF7 |

ALT5 and ALT3 are not particularly useful, as they are both lacking one of the critical pins. ALT6 however gives you SPI on the right pins of PORTC to be useful for MVIO, while DEFAULT or ALT4 gives you non-MVIO-referenced SPI levels.

### TWI0 mux options
| Mapping | swap | Master or Slave | Dual Mode Slave |
|---------|------|-----------------|-----------------|
| DEFAULT | 0    | SDA/PA2 SCL/PA3 | SDA/PC2 SCL/PC3 |
| ~ALT1~  | ~1~  | ~SDA/PA2 SCL/PA3~ | ~Not avail.~  |
| ALT2    | 2    | SDA/PC2 SCL/PC3 | Not avail.      |
| ALT3    | 3    | SDA/PA0 SCL/PA1 | SDA/PC2 SCL/PC3 |

Note that this means that you want Wire.swap(0, 2, or 3, but not 1). PA0 and PA1 are unavailable if using an external crystal.

### PWM Pins
With 20 pins, there still isn't a whole lot of choice...
* TCA0 obviously wants to be on PORTA, the only port with more than half of it's outputs.
* TCD0 can go either way as required, we leave it at default.
* The TCBs don't get used for PWM - they share PA2 and PA3 with TCA0, and no different PORTMUX option can return at least the three pins you lose from switching to PORTC instead of PORTA, though they will be used if PORTMUX is set to point TCA0 to a port other than PORTA, and the timer isn't being used for millis, which TCB1 usually is.

#### TCA mux options
| TCA0    | WO0 | WO1 | WO2 | WO3 | WO4 | WO5 |
|---------|-----|-----|-----|-----|-----|-----|
| PORTA   | PA0 | PA1 | PA2 | PA3 | PA4 | PA5 |
| PORTC   |  -  | PC1 | PC2 | PC3 |  -  |  -  |
| PORTD   |  -  | PD1 | PD2 | PD3 | PD4 | PD5 |

analogWrite() is "PORTMUX-aware" and if you set `PORTMUX.TCAROUTEA` to a value other than 0, that sets the port to be used. PORTC is 2, PORTD is 3, as you would expect.

#### TCB mux options
| TCBn | Default | Alt |
|------|---------|-----|
| TCB0 |    PA2  |  -  |
| TCB1 |    PA3  |  -  |

Not much of a choice, and are not used by default since those pins are shared with the "best" TCA0 mapping.

#### TCD0 mux options
| TCD0    | WOA | WOB | WOC | WOD |
|---------|-----|-----|-----|-----|
| DEFAULT | PA4 | PA5 | PA6 | PA7 |
| ALT4    | PA4 | PA5 | PD4 | PD5 |

Like TCA, in 1.5.0 of DxCore, if you set the TCD portmux (`PORTMUX.TCDROUTEA`), digitalWrite and analogWrite() will be aware of it (digitalWriteFast is never aware of PWM, don't use it to shut off PWM, it won't). TCA is used in preference to TCD when both are available on one pin. Since default is usable, we don't change it.

### LED_BUILTIN
Thank god - we have a PA7 here!

To match other parts, `PIN_PA7` shall be the pin that the core "expects" to be connected to an LED **unless** Optiboot is used with the Serial1 Alt2 pinset. In that case, PD7 is used for serial communication, so `PIN_PD5` is used instead. LED_BUILTIN is defined as that pin, and the bootloader will set that pin as output and try to blink the LED. Note that if the bootloader is not used, and your sketch does not reference `LED_BUILTIN` this pin is not otherwise treated any differently.

## Official Documentation
The official product page contains links to the datasheet, errata, and some application notes.
* [AVR64DD20 product page](https://www.microchip.com/en-us/product/AVR64DD20)
* [AVR32DD20 product page](https://www.microchip.com/en-us/product/AVR32DD20)
* [AVR16DD20 product page](https://www.microchip.com/en-us/product/AVR32DD20)
